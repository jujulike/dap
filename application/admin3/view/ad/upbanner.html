{extend name="public/base" /}
{block name="body"}
<script src="__PUBLIC__/admin/js/jquery-2.1.1.min.js"></script>
<script src="__PUBLIC__/home/layui/layui.js"></script>
<link href="__PUBLIC__/home/layui/css/layui.css" rel="stylesheet">
<div class="wrapper wrapper-content animated fadeInRight">
    <style type="text/css">
    .main .form-horizontal .form-group{margin-bottom:0;}
    #modal-confirmsend .form-group{margin-bottom:15px;display: flex;}
    #modal-confirmsend .control-label{margin-top:0;}
</style>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox-content">
                <form action="{:url()}" method="post"  enctype="multipart/form-data" class="form-horizontal">
                    <input  name="id" value="{$banner.id|default='0'}" style="display: none;">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">广告名称</label>
                        <div class="col-sm-6">
                               <input type="text" class="form-control" name="name"  value="{$banner.name|default=''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">广告位置</label>
                        <div class="col-sm-6">
                            <select name="tid" id="adtid" class="form-control">
                                {volist name="adtype" id="vo"}
                                <option value="{$vo.id}" {if $banner['tid']==$vo['id']}selected{/if}>{$vo.name}</option>
                                {/volist}
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="catpid" {if $banner['tid']!=2}style="display:none;"{/if}>
                        <label class="col-sm-2 control-label">选择分类</label>
                        <div class="col-sm-6">
                            <select name="catid"  class="form-control">
                                {volist name="category" id="vo"}
                                <option value="{$vo.id}" {if $banner['catid']==$vo['id']}selected{/if}>{$vo.catename}</option>
                                {/volist}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">广告描述</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" name="desc"   value="{$banner.desc|default=''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">广告链接</label>
                        <div class="input-group col-sm-6" style="padding-right:15px;padding-left: 15px;">
                          <input type="text" readonly class="form-control" name="url" value="{$banner.url|default=''}" id="adrres">
                          <div class="input-group-addon" data-toggle="modal" data-target="#modal-confirmsend">选择链接</div>
                        </div>
                        
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">广告排序</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" name="sortorder" value="{$banner.sortorder|default='0'}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label">广告图片(750*320)</label>
                        <div class="col-sm-6">
                            <img id="showhead" src="{$banner.img|default='__PUBLIC__/admin/img/webuploader.png'}" style="max-height: 200px;max-width: 400px;">
                            <input type="file" name="banner" id="file_head" class="hide">
                        </div>
                    </div>
              
                    <input type="hidden" name="isurl" value="{$banner.isurl}" id="isurl">
                    <div class="form-group">
                        <div class="col-sm-9 col-sm-offset-2">
                            <button class="btn btn-primary" id="submit" type="submit" target-form="form-horizontal">确 定</button>
                            <button class="btn btn-default" onclick="javascript:history.back(-1);return false;">返 回</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
<div id="modal-confirmsend" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="width:600px;margin:0px auto;">
           
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                        <h3>选择链接</h3>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">可选链接</label>
                            <div class="col-sm-9 col-xs-12">
                                <select class="form-control" id="urls" required>
                                    <option value="1">商场首页</option>
                                    <option value="2">商品列表</option>
                                    <option value="3">商品详情</option>
                                    <option value="4">个人中心</option>
                                    <option value="5">商城订单</option>
                                    <option value="6">领券中心</option>
                                    <option value="7">商品类型</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" style="display: none;" id="idps">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">id</label>
                            <div class="col-sm-9 col-xs-12">
                                <input type="number" min="0" id="ids" class="form-control" />
                                <p>id请填写在列表中相关详情的ID</p>
                            </div>
                        </div>
                        <div id="module-menus"></div>
                    </div>
                    <div class="modal-footer">
                        
                        <button type="button" class="btn btn-primary" id="bthid" data-dismiss="modal">确认</button> 
                    </div>
                </div>
            </div>
            
        </div>
{/block}

{block name="script"}
<script type="text/javascript">
    //导航高亮
    highlight_subnav('{:url('ad/bander')}');
</script>
<script type="text/javascript">
    $(function(){
        $("#file_head").on('change',function(){
            var objUrl = getObjectURL(this.files[0]) ;
            console.log("objUrl = "+objUrl) ;
            if (objUrl) {
                $("#showhead").attr("src", objUrl) ;
            }
        });
        $("#showhead").click(function(){
            $("#file_head").click();
        });
        $("#urls").change(function(){
            var value=$(this).val();
            if(value==3 || value==7 ){
                $("#idps").show();
            }else{
                $("#idps").hide();
            }
        })
        $("#adtid").change(function(){
            var value=$(this).val();
            if(value==2 ){
                $("#catpid").show();
            }else{
                $("#catpid").hide();
            }
        })
        $("#bthid").click(function(){
            var value=$("#urls").val();
            var urls="";
            var ids=$("#ids").val();
            var isurl=0;
            if(value==1){
                urls="/pages/wlxm/wlxm";
            }else if(value==2){
                urls="/pages/xmdetail/xmdetail?id="+ids;
            }else if(value==3){
                urls="/pages/jqhx/jqhx";
            }else if(value==4){
                urls="/pages/hddetail/hddetai?id="+ids;
            }else if(value==5){
                urls="/pages/jqdt/jqdt";
            }else if(value==6){
                urls="/pages/dtdetail/dtdetail?id="+ids;
            }else if(value==7){
                urls="/pages/tsms/tsms";
            }else if(value==8){
                urls="/pages/dpdetail/dpdetail?id="+ids;
            }else if(value==9){
                urls="/pages/book/book";
                isurl=1;
            }else if(value==10){
                urls="/pages/jddetail/jddetail?id="+ids;
            }else if(value==11){
                urls="/pages/shop/shop";
                isurl=1;
            }else if(value==12){
                urls="/pages/mslist/mslist";
            }else if(value==13){
                urls="/pages/ptlist/ptlist";
            }else if(value==14){
                urls="/pages/goodlist/goodlist";
            }else if(value==15){
                urls="/pages/gdetail/gdetail?goodid="+ids;
            }else if(value==16){
                urls="/pages/mine/mine";
                isurl=1;
            }else if(value==17){
                urls="/pages/myscore/myscore";
            }else if(value==18){
                urls="/pages/mgzcsa/mgzcsa";
            }else if(value==19){
                urls="/pages/shopporder/shopporder";
            }else if(value==20){
                urls="/pages/orderyd/orderyd?tid=hotel_order";
            }else if(value==21){
                urls="/pages/orderyd/orderyd?tid=play_order";
            }else if(value==22){
                urls="/pages/orderyd/orderyd?tid=restaurant_order";
            }else if(value==23){
                urls="/pages/orderyd/orderyd?tid=ticket_order";
            }else if(value==24){
                urls="/pages/orderyd/orderyd?tid=activity_order";
            }else if(value==25){
                urls="/pages/mycard/mycard?istype=1";
            }else if(value==26){
                urls="/pages/jfshop/jfshop";
            }else if(value==27){
                urls="/pages/tickets/tickets";
            }else if(value==28){
                urls="/pages/tdetail/tdetail?id="+ids;
            }
            $("#isurl").val(isurl);
            $("#adrres").val(urls);
        })
    });
    //建立一個可存取到該file的url
    function getObjectURL(file) {
        var url = null ;
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }
</script>
{/block}